(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{5452:function(e,t,n){e.exports=n(5639)},5457:function(e,t,n){},5458:function(e,t,n){},5639:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n(16),o=(n(5457),n(5458),n(24)),c=n(33),s=n(17),i=n.n(s),l=n(23),u=n(19),m=n(2),p=n(18),d=n(79),f=n.n(d),h=n(80),g=n(81),v=n(83),b=n(82),E=n(84),w=function(){try{return JSON.parse(window.localStorage.getItem("token")).token}catch(e){return""}},k=function(e,t){return fetch(e,{method:"POST",headers:{"Content-Type":"application/json","x-access-token":w()},body:JSON.stringify(t)}).then(function(e){return e.json()})},y=function(e){return fetch(e,{method:"GET",headers:{"x-access-token":w()}}).then(function(e){return e.json()})},j=function(){try{var e=JSON.parse(window.localStorage.getItem("token"));return JSON.parse(e.user)}catch(t){return{}}},x=n(51),O={success:x.a,warning:x.e,error:x.c,info:x.d},S=Object(p.withStyles)(function(e){return{message:{display:"flex",alignItems:"center"},icon:{fontSize:20,opacity:.9,marginRight:e.spacing.unit},close:{padding:2*e.spacing.unit},success:{backgroundColor:m.t.green[600]},error:{backgroundColor:e.palette.error.dark},info:{backgroundColor:e.palette.primary.dark},warning:{backgroundColor:m.t.amber[700]}}})(function(e){var t=e.variant,n=e.message,a=e.onExited,o=e.classes,c=r.useState(!1),s=Object(u.a)(c,2),i=s[0],l=s[1],p=O[t];return r.useEffect(function(){l(!0)},[n]),r.createElement(m.k,{anchorOrigin:{vertical:"top",horizontal:"center"},open:i,autoHideDuration:3e3,onClose:function(){return l(!1)},onExited:a},r.createElement(m.l,{className:o[t],"aria-describedby":"client-snackbar",message:r.createElement("span",{id:"client-snackbar",className:o.message},r.createElement(p,{className:o.icon}),n),action:[r.createElement(m.i,{key:"close","aria-label":"Close",color:"inherit",className:o.close,onClick:function(){return l(!1)}},r.createElement(x.b,null))]}))}),C="success",N=r.createContext({}),P=k,R=function(e){function t(){var e,n;Object(h.a)(this,t);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(n=Object(v.a)(this,(e=Object(b.a)(t)).call.apply(e,[this].concat(a)))).handleLogin=function(e,t){return new Promise(function(){var n=Object(l.a)(i.a.mark(function n(r){var a;return i.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,P("/api/user/login",{username:e,password:t});case 3:a=n.sent,window.localStorage.setItem("token",JSON.stringify(a)),r(!0),n.next=11;break;case 8:n.prev=8,n.t0=n.catch(0),r(!1);case 11:case"end":return n.stop()}},n,null,[[0,8]])}));return function(e){return n.apply(this,arguments)}}())},n.handleReserve=function(e){var t=e.book_id,r=e.start_date,a=e.end_date;return new Promise(function(){var e=Object(l.a)(i.a.mark(function e(o){var c,s,l;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,P("/api/books/".concat(t,"/reserve"),{start_date:r,end_date:a});case 3:c=e.sent,s=c.code,l=c.message,o(s===C),s!==C?n.setState({messageProps:{variant:"error",message:l}}):n.setState({messageProps:{variant:"success",message:l}}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),o(!1);case 13:case"end":return e.stop()}},e,null,[[0,10]])}));return function(t){return e.apply(this,arguments)}}())},n.handleMyReserve=function(e){return new Promise(function(){var t=Object(l.a)(i.a.mark(function t(r){var a,o,c;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,P("api/user/".concat(e,"/reservations"),{});case 3:a=t.sent,o=a.code,c=a.data,o===C?(n.setState({reservations:c}),r(!0)):r(!1),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(0),r(!1);case 12:case"end":return t.stop()}},t,null,[[0,9]])}));return function(e){return t.apply(this,arguments)}}())},n.handleSignup=function(e,t){return new Promise(function(){var r=Object(l.a)(i.a.mark(function r(a){var o,c,s;return i.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,P("api/user",{name:e,password:t});case 3:o=r.sent,c=o.code,s=o.message,a(c===C),n.setState({messageProps:{variant:c,message:s}}),r.next=13;break;case 10:r.prev=10,r.t0=r.catch(0),a(!1);case 13:case"end":return r.stop()}},r,null,[[0,10]])}));return function(e){return r.apply(this,arguments)}}())},n.state={reservations:[],onLogin:n.handleLogin,onReserve:n.handleReserve,onMyReservations:n.handleMyReserve,onSignup:n.handleSignup},n}return Object(E.a)(t,e),Object(g.a)(t,[{key:"render",value:function(){var e=this,t=this.state.messageProps;return r.createElement(N.Provider,{value:this.state},this.props.children,t&&r.createElement(S,Object.assign({},t,{onExited:function(){return e.setState({messageProps:void 0})}})))}}]),t}(r.Component),I=N,_=Object(p.withStyles)(function(e){return{root:{height:"100vh"},paper:{padding:10}}})(Object(o.e)(function(e){var t=e.classes,n=e.history,a=r.useState(""),o=Object(u.a)(a,2),s=o[0],p=o[1],d=r.useState(""),h=Object(u.a)(d,2),g=h[0],v=h[1],b=r.useContext(I).onLogin;return r.createElement(m.h,{className:t.root,container:!0,direction:"row",justify:"center",alignItems:"center"},r.createElement("form",null,r.createElement(m.j,{className:t.paper},r.createElement(m.r,{required:!0,id:"username",label:"Name",placeholder:"Input user name",value:s,onChange:function(e){return p(e.target.value)},margin:"normal",fullWidth:!0}),r.createElement(m.r,{required:!0,id:"password",label:"Password",type:"password",placeholder:"Input password",value:g,onChange:function(e){return v(e.target.value)},margin:"normal",fullWidth:!0}),r.createElement(m.h,{container:!0,justify:"space-around",alignItems:"center"},r.createElement(m.b,{variant:"contained",color:"primary",onClick:Object(l.a)(i.a.mark(function e(){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b(s,f()(g));case 2:e.sent&&n.push("/");case 4:case"end":return e.stop()}},e)}))},"Sign in"),r.createElement(c.b,{to:"/signup"},r.createElement(m.b,{color:"inherit"},"Sign Up"))))))})),q=r.createContext({}),B=y,D=function(e){function t(){var e,n;Object(h.a)(this,t);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(n=Object(v.a)(this,(e=Object(b.a)(t)).call.apply(e,[this].concat(a)))).handleBooks=function(){return new Promise(function(){var e=Object(l.a)(i.a.mark(function e(t){var r;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,B("/api/books");case 3:r=e.sent,n.setState({books:r}),t(!0),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),t(!1);case 11:case"end":return e.stop()}},e,null,[[0,8]])}));return function(t){return e.apply(this,arguments)}}())},n}return Object(E.a)(t,e),Object(g.a)(t,[{key:"componentWillMount",value:function(){this.setState({books:{total:0,page:1,pageSize:10,result:[]},onBooks:this.handleBooks})}},{key:"render",value:function(){return r.createElement(q.Provider,{value:this.state},this.props.children)}}]),t}(r.Component),T=q,W=n(61),J=n(178),L=n.n(J),M=Object(p.withStyles)(function(e){return{root:{},content:{},text:{fontSize:20,marginBottom:2*e.spacing.unit}}})(function(e){var t=r.useContext(I).onReserve,n=e.book,a=e.onReserved,o=e.classes,c=r.useState(!1),s=Object(u.a)(c,2),p=s[0],d=s[1],f=r.useState(!1),h=Object(u.a)(f,2),g=h[0],v=h[1],b=r.useState(new Date),E=Object(u.a)(b,2),w=E[0],k=E[1],y=r.useState(new Date),j=Object(u.a)(y,2),x=j[0],O=j[1],S=r.useState(L.a().days(7).toDate()),C=Object(u.a)(S,2),N=C[0],P=C[1],R=r.useState(new Date),_=Object(u.a)(R,2),q=_[0],B=_[1],D=r.useState(),T=Object(u.a)(D,2),J=T[0],M=T[1];return r.createElement(r.Fragment,null,r.createElement(m.b,{color:"primary",onClick:function(){return d(!0)}},"Reserve"),r.createElement(m.c,{open:p,onClose:function(){d(!1),M(void 0)},title:"Reserve ".concat(n.title),"aria-labelledby":"form-dialog-title",className:o.root},r.createElement(m.g,{id:"form-dialog-title"},"Reserve ",n.title),r.createElement(m.e,{className:o.content},r.createElement(m.f,{className:o.text},"Enjoy the reading."),J&&r.createElement(m.f,{color:"secondary",className:o.text},J),r.createElement(m.h,{container:!0,direction:"row",spacing:16},r.createElement(m.h,{item:!0,xs:6},r.createElement(W.a,{label:"Pick start date",name:"date-input",value:w,onChange:function(e){return k(e)},min:new Date,max:N})),r.createElement(m.h,{item:!0,xs:6},r.createElement(W.b,{label:"Pick start time",name:"time-input",value:x,onChange:function(e){return O(e)}}))),r.createElement(m.h,{container:!0,direction:"row",spacing:16},r.createElement(m.h,{item:!0,xs:6},r.createElement(W.a,{label:"Pick end date",name:"date-input",value:N,onChange:function(e){return P(e)},min:w})),r.createElement(m.h,{item:!0,xs:6},r.createElement(W.b,{label:"Pick end time",name:"time-input",value:q,onChange:function(e){return B(e)}})))),r.createElement(m.d,null,r.createElement(m.b,{color:"primary",onClick:function(){d(!1),M(void 0)}},"Cancel"),r.createElement(m.b,{color:"primary",disabled:g,onClick:Object(l.a)(i.a.mark(function e(){var r,o,c;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(v(!0),r=w.getTime(),!((o=N.getTime())-r<36e5)){e.next=8;break}M("Duration must over than 60 minutes."),v(!1),e.next=14;break;case 8:return e.next=10,t({book_id:n._id,start_date:r,end_date:o});case 10:c=e.sent,a(c),d(!1),v(!1);case 14:case"end":return e.stop()}},e)}))},"Reserve"))))}),z=Object(p.withStyles)(function(e){return{root:{},topbar:{padding:2*e.spacing.unit,marginBottom:e.spacing.unit},profile:{color:e.palette.grey[50]}}})(Object(o.e)(function(e){var t=e.classes,n=e.history,a=r.useContext(T),o=a.books,s=a.onBooks;return r.useEffect(function(){0===o.total&&s()}),r.createElement("div",{className:t.root},r.createElement(m.a,{position:"static",className:t.topbar},r.createElement(m.h,{container:!0,justify:"space-between",alignItems:"center"},r.createElement(m.s,{variant:"h6",color:"inherit"},"Library"),r.createElement("span",null,r.createElement(c.b,{to:"/profile"},r.createElement(m.b,{className:t.profile},"My Reservations")),r.createElement(m.b,{color:"inherit",onClick:function(){window.localStorage.setItem("token",void 0),n.push("/login")}},"Logout ",j().name)))),r.createElement(m.m,null,r.createElement(m.p,null,r.createElement(m.q,null,r.createElement(m.o,null,"Title"),r.createElement(m.o,null,"Description"),r.createElement(m.o,null,"Count"),r.createElement(m.o,null))),r.createElement(m.n,null,o.result.map(function(e){return r.createElement(m.q,{key:e._id},r.createElement(m.o,null,e.title),r.createElement(m.o,null,e.description),r.createElement(m.o,null,"Total: ",e.count,", ",e.count-e.reserved," remains"),r.createElement(m.o,null,r.createElement(M,{book:e,onReserved:function(e){e&&s()}})))}))))})),A=Object(p.withStyles)(function(e){return{root:{height:"100vh"},paper:{padding:e.spacing.unit}}})(Object(o.e)(function(e){var t=e.classes,n=r.useContext(I).onSignup,a=r.useState(),o=Object(u.a)(a,2),c=o[0],s=o[1],p=r.useState(),d=Object(u.a)(p,2),h=d[0],g=d[1],v=r.useState(),b=Object(u.a)(v,2),E=b[0],w=b[1];return r.createElement(m.h,{className:t.root,container:!0,direction:"row",justify:"center",alignItems:"center"},r.createElement(m.j,{className:t.paper},r.createElement("h2",null,"Sign up"),r.createElement(m.r,{required:!0,label:"Name",id:"username",placeholder:"Input name",value:c,margin:"normal",fullWidth:!0,onChange:function(e){return s(e.target.value)}}),r.createElement(m.r,{required:!0,type:"password",label:"Password",id:"password",placeholder:"Input password",value:h,margin:"normal",fullWidth:!0,onChange:function(e){return g(e.target.value)}}),r.createElement(m.r,{required:!0,type:"password",label:"Re-Password",id:"re-password",placeholder:"Input password again",value:E,margin:"normal",fullWidth:!0,error:E!==h,helperText:E!==h?"Passwords are not match.":void 0,onChange:function(e){return w(e.target.value)}}),r.createElement(m.b,{variant:"contained",color:"primary",onClick:Object(l.a)(i.a.mark(function t(){return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(h!==E){t.next=5;break}return t.next=3,n(c,f()(h));case 3:t.sent&&e.history.push("/login");case 5:case"end":return t.stop()}},t)}))},"Sign Up")))})),U=Object(p.withStyles)(function(e){return{root:{}}})(function(e){var t=e.classes,n=r.useContext(I),a=n.onMyReservations,o=n.reservations,c=r.useContext(T),s=c.books,i=c.onBooks;return r.useEffect(function(){a(j()._id),i()},[1]),r.createElement("div",{className:t.root},r.createElement(m.m,null,r.createElement(m.p,null,r.createElement(m.q,null,r.createElement(m.o,null,"Title"),r.createElement(m.o,null,"Description"))),r.createElement(m.n,null,o.map(function(e){var t=s.result.find(function(t){return e.book_id===t._id})||{};return r.createElement(m.q,{key:e._id},r.createElement(m.o,null,t.title),r.createElement(m.o,null,t.description))}))))});function F(){return r.createElement("div",{className:"App"},r.createElement(o.c,null,r.createElement(o.a,{path:"/",component:z,exact:!0}),r.createElement(o.a,{path:"/login",component:_}),r.createElement(o.a,{path:"/signup",component:A}),r.createElement(o.a,{path:"/profile",component:U})))}Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a.render(r.createElement(function(){return r.createElement(c.a,null,r.createElement(R,null,r.createElement(D,null,r.createElement(F,null))))},null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[5452,1,2]]]);
//# sourceMappingURL=main.753a86cc.chunk.js.map