(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{5452:function(e,t,n){e.exports=n(5639)},5457:function(e,t,n){},5458:function(e,t,n){},5639:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n(16),o=(n(5457),n(5458),n(19)),c=n(40),i=n(17),s=n.n(i),l=n(24),u=n(20),m=n(2),p=n(18),d=n(79),f=n.n(d),h=n(80),g=n(81),v=n(83),b=n(82),E=n(84),w=function(){try{return JSON.parse(window.localStorage.getItem("token")).token}catch(e){return""}},k={post:function(e,t){return fetch(e,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"JWT ".concat(w())},body:JSON.stringify(t)}).then(function(e){return 401===e.status?Promise.resolve({code:"invalid token"}):e.json()})},get:function(e){return fetch(e,{method:"GET",headers:{Authorization:"JWT ".concat(w())}}).then(function(e){return 401===e.status?Promise.resolve({code:"invalid token"}):e.json()}).catch(function(e){return console.log(e)})},getUser:function(){try{return JSON.parse(window.localStorage.getItem("token")).user}catch(e){return{}}},invalidToken:function(e){return"invalid token"===e.code}},y=n(51),j={success:y.a,warning:y.e,error:y.c,info:y.d},O=Object(p.withStyles)(function(e){return{message:{display:"flex",alignItems:"center"},icon:{fontSize:20,opacity:.9,marginRight:e.spacing.unit},close:{padding:2*e.spacing.unit},success:{backgroundColor:m.t.green[600]},error:{backgroundColor:e.palette.error.dark},info:{backgroundColor:e.palette.primary.dark},warning:{backgroundColor:m.t.amber[700]}}})(function(e){var t=e.variant,n=e.message,a=e.onExited,o=e.classes,c=r.useState(!1),i=Object(u.a)(c,2),s=i[0],l=i[1],p=j[t];return r.useEffect(function(){l(!0)},[n]),r.createElement(m.k,{anchorOrigin:{vertical:"top",horizontal:"center"},open:s,autoHideDuration:3e3,onClose:function(){return l(!1)},onExited:a},r.createElement(m.l,{className:o[t],"aria-describedby":"client-snackbar",message:r.createElement("span",{id:"client-snackbar",className:o.message},r.createElement(p,{className:o.icon}),n),action:[r.createElement(m.i,{key:"close","aria-label":"Close",color:"inherit",className:o.close,onClick:function(){return l(!1)}},r.createElement(y.b,null))]}))}),x="success",S=r.createContext({}),C=k.post,N=function(e){function t(){var e,n;Object(h.a)(this,t);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(n=Object(v.a)(this,(e=Object(b.a)(t)).call.apply(e,[this].concat(a)))).redirect=function(e){k.invalidToken(e)&&n.props.history.push("/login")},n.handleLogin=function(e,t){return new Promise(function(){var r=Object(l.a)(s.a.mark(function r(a){var o;return s.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,C("/api/user/login",{username:e,password:t});case 3:o=r.sent,n.redirect(o),window.localStorage.setItem("token",JSON.stringify(o)),a(!0),r.next=12;break;case 9:r.prev=9,r.t0=r.catch(0),a(!1);case 12:case"end":return r.stop()}},r,null,[[0,9]])}));return function(e){return r.apply(this,arguments)}}())},n.handleReserve=function(e){var t=e.book_id,r=e.start_date,a=e.end_date;return new Promise(function(){var e=Object(l.a)(s.a.mark(function e(o){var c,i,l;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,C("/api/books/".concat(t,"/reserve"),{start_date:r,end_date:a});case 3:c=e.sent,i=c.code,l=c.message,n.redirect({code:i}),o(i===x),i!==x?n.setState({messageProps:{variant:"error",message:l}}):n.setState({messageProps:{variant:"success",message:l}}),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),o(!1);case 14:case"end":return e.stop()}},e,null,[[0,11]])}));return function(t){return e.apply(this,arguments)}}())},n.handleMyReserve=function(e){return new Promise(function(){var t=Object(l.a)(s.a.mark(function t(r){var a,o,c;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,C("api/user/".concat(e,"/reservations"),{});case 3:a=t.sent,o=a.code,c=a.data,n.redirect({code:o}),o===x?(n.setState({reservations:c}),r(!0)):r(!1),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(0),r(!1);case 13:case"end":return t.stop()}},t,null,[[0,10]])}));return function(e){return t.apply(this,arguments)}}())},n.handleSignup=function(e,t){return new Promise(function(){var r=Object(l.a)(s.a.mark(function r(a){var o,c,i;return s.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,C("api/user",{name:e,password:t});case 3:o=r.sent,c=o.code,i=o.message,n.redirect({code:c}),a(c===x),n.setState({messageProps:{variant:c,message:i}}),r.next=14;break;case 11:r.prev=11,r.t0=r.catch(0),a(!1);case 14:case"end":return r.stop()}},r,null,[[0,11]])}));return function(e){return r.apply(this,arguments)}}())},n.state={reservations:[],onLogin:n.handleLogin,onReserve:n.handleReserve,onMyReservations:n.handleMyReserve,onSignup:n.handleSignup},n}return Object(E.a)(t,e),Object(g.a)(t,[{key:"render",value:function(){var e=this,t=this.state.messageProps;return r.createElement(S.Provider,{value:this.state},this.props.children,t&&r.createElement(O,Object.assign({},t,{onExited:function(){return e.setState({messageProps:void 0})}})))}}]),t}(r.Component),P=S,R=Object(o.e)(N),I=Object(p.withStyles)(function(e){return{root:{height:"100vh"},paper:{padding:10}}})(Object(o.e)(function(e){var t=e.classes,n=(e.history,r.useState("")),a=Object(u.a)(n,2),o=a[0],i=a[1],p=r.useState(""),d=Object(u.a)(p,2),h=d[0],g=d[1],v=r.useContext(P).onLogin;return r.createElement(m.h,{className:t.root,container:!0,direction:"row",justify:"center",alignItems:"center"},r.createElement("form",null,r.createElement(m.j,{className:t.paper},r.createElement(m.r,{required:!0,id:"username",label:"Name",placeholder:"Input user name",value:o,onChange:function(e){return i(e.target.value)},margin:"normal",fullWidth:!0}),r.createElement(m.r,{required:!0,id:"password",label:"Password",type:"password",placeholder:"Input password",value:h,onChange:function(e){return g(e.target.value)},margin:"normal",fullWidth:!0}),r.createElement(m.h,{container:!0,justify:"space-around",alignItems:"center"},r.createElement(m.b,{variant:"contained",color:"primary",onClick:Object(l.a)(s.a.mark(function e(){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v(o,f()(h));case 2:e.sent&&(window.location.href="//".concat(window.location.host));case 4:case"end":return e.stop()}},e)}))},"Sign in"),r.createElement(c.b,{to:"/signup"},r.createElement(m.b,{color:"inherit"},"Sign Up"))))))})),T=r.createContext({}),_=(k.post,k.get),W=function(e){function t(){var e,n;Object(h.a)(this,t);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(n=Object(v.a)(this,(e=Object(b.a)(t)).call.apply(e,[this].concat(a)))).redirect=function(e){k.invalidToken(e)&&n.props.history.push("/login")},n.handleBooks=function(){return new Promise(function(){var e=Object(l.a)(s.a.mark(function e(t){var r;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,_("/api/books");case 3:r=e.sent,n.redirect(r),n.setState({books:r}),t(!0),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),t(!1);case 12:case"end":return e.stop()}},e,null,[[0,9]])}));return function(t){return e.apply(this,arguments)}}())},n}return Object(E.a)(t,e),Object(g.a)(t,[{key:"componentWillMount",value:function(){this.setState({books:{total:0,page:1,pageSize:10,result:[]},onBooks:this.handleBooks})}},{key:"render",value:function(){return r.createElement(T.Provider,{value:this.state},this.props.children)}}]),t}(r.Component),q=T,B=Object(o.e)(W),D=n(61),J=n(178),z=n.n(J),L=Object(p.withStyles)(function(e){return{root:{},content:{},text:{fontSize:20,marginBottom:2*e.spacing.unit}}})(function(e){var t=r.useContext(P).onReserve,n=e.book,a=e.onReserved,o=e.classes,c=r.useState(!1),i=Object(u.a)(c,2),p=i[0],d=i[1],f=r.useState(!1),h=Object(u.a)(f,2),g=h[0],v=h[1],b=r.useState(new Date),E=Object(u.a)(b,2),w=E[0],k=E[1],y=r.useState(new Date),j=Object(u.a)(y,2),O=j[0],x=j[1],S=r.useState(z.a().days(7).toDate()),C=Object(u.a)(S,2),N=C[0],R=C[1],I=r.useState(new Date),T=Object(u.a)(I,2),_=T[0],W=T[1],q=r.useState(),B=Object(u.a)(q,2),J=B[0],L=B[1];return r.createElement(r.Fragment,null,r.createElement(m.b,{color:"primary",onClick:function(){return d(!0)}},"Reserve"),r.createElement(m.c,{open:p,onClose:function(){d(!1),L(void 0)},title:"Reserve ".concat(n.title),"aria-labelledby":"form-dialog-title",className:o.root},r.createElement(m.g,{id:"form-dialog-title"},"Reserve ",n.title),r.createElement(m.e,{className:o.content},r.createElement(m.f,{className:o.text},"Enjoy the reading."),J&&r.createElement(m.f,{color:"secondary",className:o.text},J),r.createElement(m.h,{container:!0,direction:"row",spacing:16},r.createElement(m.h,{item:!0,xs:6},r.createElement(D.a,{label:"Pick start date",name:"date-input",value:w,onChange:function(e){return k(e)},min:new Date,max:N})),r.createElement(m.h,{item:!0,xs:6},r.createElement(D.b,{label:"Pick start time",name:"time-input",value:O,onChange:function(e){return x(e)}}))),r.createElement(m.h,{container:!0,direction:"row",spacing:16},r.createElement(m.h,{item:!0,xs:6},r.createElement(D.a,{label:"Pick end date",name:"date-input",value:N,onChange:function(e){return R(e)},min:w})),r.createElement(m.h,{item:!0,xs:6},r.createElement(D.b,{label:"Pick end time",name:"time-input",value:_,onChange:function(e){return W(e)}})))),r.createElement(m.d,null,r.createElement(m.b,{color:"primary",onClick:function(){d(!1),L(void 0)}},"Cancel"),r.createElement(m.b,{color:"primary",disabled:g,onClick:Object(l.a)(s.a.mark(function e(){var r,o,c;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(v(!0),r=w.getTime(),!((o=N.getTime())-r<36e5)){e.next=8;break}L("Duration must over than 60 minutes."),v(!1),e.next=14;break;case 8:return e.next=10,t({book_id:n._id,start_date:r,end_date:o});case 10:c=e.sent,a(c),d(!1),v(!1);case 14:case"end":return e.stop()}},e)}))},"Reserve"))))}),M=Object(p.withStyles)(function(e){return{root:{},topbar:{padding:2*e.spacing.unit,marginBottom:e.spacing.unit},profile:{color:e.palette.grey[50]}}})(Object(o.e)(function(e){var t=e.classes,n=e.history,a=r.useContext(q),o=a.books,i=a.onBooks;return r.useEffect(function(){0===o.total&&i()}),r.createElement("div",{className:t.root},r.createElement(m.a,{position:"static",className:t.topbar},r.createElement(m.h,{container:!0,justify:"space-between",alignItems:"center"},r.createElement(m.s,{variant:"h6",color:"inherit"},"Library"),r.createElement("span",null,r.createElement(c.b,{to:"/profile"},r.createElement(m.b,{className:t.profile},"My Reservations")),r.createElement(m.b,{color:"inherit",onClick:function(){window.localStorage.setItem("token",void 0),n.push("/login")}},"Logout ",k.getUser().name)))),r.createElement(m.m,null,r.createElement(m.p,null,r.createElement(m.q,null,r.createElement(m.o,null,"Title"),r.createElement(m.o,null,"Description"),r.createElement(m.o,null,"Count"),r.createElement(m.o,null))),r.createElement(m.n,null,(o.result||[]).map(function(e){return r.createElement(m.q,{key:e._id},r.createElement(m.o,null,e.title),r.createElement(m.o,null,e.description),r.createElement(m.o,null,"Total: ",e.count,", ",e.count-e.reserved," remains"),r.createElement(m.o,null,r.createElement(L,{book:e,onReserved:function(e){e&&i()}})))}))))})),A=Object(p.withStyles)(function(e){return{root:{height:"100vh"},paper:{padding:e.spacing.unit}}})(Object(o.e)(function(e){var t=e.classes,n=r.useContext(P).onSignup,a=r.useState(),o=Object(u.a)(a,2),c=o[0],i=o[1],p=r.useState(),d=Object(u.a)(p,2),h=d[0],g=d[1],v=r.useState(),b=Object(u.a)(v,2),E=b[0],w=b[1];return r.createElement(m.h,{className:t.root,container:!0,direction:"row",justify:"center",alignItems:"center"},r.createElement(m.j,{className:t.paper},r.createElement("h2",null,"Sign up"),r.createElement(m.r,{required:!0,label:"Name",id:"username",placeholder:"Input name",value:c,margin:"normal",fullWidth:!0,onChange:function(e){return i(e.target.value)}}),r.createElement(m.r,{required:!0,type:"password",label:"Password",id:"password",placeholder:"Input password",value:h,margin:"normal",fullWidth:!0,onChange:function(e){return g(e.target.value)}}),r.createElement(m.r,{required:!0,type:"password",label:"Re-Password",id:"re-password",placeholder:"Input password again",value:E,margin:"normal",fullWidth:!0,error:E!==h,helperText:E!==h?"Passwords are not match.":void 0,onChange:function(e){return w(e.target.value)}}),r.createElement(m.b,{variant:"contained",color:"primary",onClick:Object(l.a)(s.a.mark(function t(){return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(h!==E){t.next=5;break}return t.next=3,n(c,f()(h));case 3:t.sent&&e.history.push("/login");case 5:case"end":return t.stop()}},t)}))},"Sign Up")))})),U=Object(p.withStyles)(function(e){return{root:{}}})(function(e){var t=e.classes,n=r.useContext(P),a=n.onMyReservations,o=n.reservations,c=r.useContext(q),i=c.books,s=c.onBooks;return r.useEffect(function(){a(k.getUser()._id),s()},[1]),r.createElement("div",{className:t.root},r.createElement(m.m,null,r.createElement(m.p,null,r.createElement(m.q,null,r.createElement(m.o,null,"Title"),r.createElement(m.o,null,"Description"))),r.createElement(m.n,null,o.map(function(e){var t=i.result.find(function(t){return e.book_id===t._id})||{};return r.createElement(m.q,{key:e._id},r.createElement(m.o,null,t.title),r.createElement(m.o,null,t.description))}))))});function F(){return r.createElement("div",{className:"App"},r.createElement(o.c,null,r.createElement(o.a,{path:"/",component:M,exact:!0}),r.createElement(o.a,{path:"/login",component:I}),r.createElement(o.a,{path:"/signup",component:A}),r.createElement(o.a,{path:"/profile",component:U})))}Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a.render(r.createElement(function(){return r.createElement(c.a,null,r.createElement(R,null,r.createElement(B,null,r.createElement(F,null))))},null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[5452,1,2]]]);
//# sourceMappingURL=main.a7446bc0.chunk.js.map